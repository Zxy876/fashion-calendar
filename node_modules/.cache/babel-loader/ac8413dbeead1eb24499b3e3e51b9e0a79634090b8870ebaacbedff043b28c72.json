{"ast":null,"code":"var _jsxFileName = \"/Users/zxydediannao/new_fashion-calendar/fashion-calendar/src/components/EventDetailPage.jsx\",\n  _s = $RefreshSig$();\n// src/components/EventDetailPage.jsx\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport moment from 'moment';\nimport './EventDetailPage.css';\nimport { storageService } from '../utils/storage';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst EventDetailPage = () => {\n  _s();\n  const {\n    date\n  } = useParams();\n  const navigate = useNavigate();\n  const [content, setContent] = useState('');\n  const [backgroundImage, setBackgroundImage] = useState('');\n  const [events, setEvents] = useState([]);\n  const [showImageUpload, setShowImageUpload] = useState(false);\n  const editorRef = useRef(null);\n  const isComposingRef = useRef(false);\n  const isInitializedRef = useRef(false); // 防止重复初始化\n\n  // 加载该日期的事件数据 - 修复版本\n  useEffect(() => {\n    console.log('🔍 加载数据，日期:', date);\n    const savedContent = storageService.getDailyContent(date);\n    const savedBackground = storageService.getDailyBackground(date);\n    const dateEvents = storageService.getEventsByDate(date);\n    console.log('📝 加载到的内容:', savedContent ? `有内容，长度: ${savedContent.length}` : '无内容');\n    console.log('🖼️ 背景图片:', savedBackground ? '有' : '无');\n    console.log('📅 事件数量:', dateEvents.length);\n\n    // 立即设置内容状态\n    setContent(savedContent || '');\n    setBackgroundImage(savedBackground || '');\n    setEvents(dateEvents);\n    isInitializedRef.current = true;\n  }, [date]);\n\n  // 初始化编辑器内容 - 关键修复！\n  useEffect(() => {\n    if (!editorRef.current) return;\n    console.log('🎯 初始化编辑器，当前内容状态:', content ? `有内容，长度: ${content.length}` : '空');\n\n    // 保存当前选区\n    const selection = window.getSelection();\n    const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\n    const currentFocus = document.activeElement;\n\n    // 设置编辑器内容\n    editorRef.current.innerHTML = content || '';\n    console.log('✅ 编辑器内容已设置:', editorRef.current.innerHTML.substring(0, 100));\n\n    // 恢复选区\n    if (range && currentFocus === editorRef.current) {\n      selection.removeAllRanges();\n      selection.addRange(range);\n    }\n\n    // 更新空状态\n    updateEmptyState();\n  }, [content, date]); // 依赖 content 和 date\n\n  const updateEmptyState = () => {\n    if (editorRef.current) {\n      const html = editorRef.current.innerHTML;\n      const isEmpty = !html || html === '<br>' || html === '<div><br></div>' || html === '&#8203;' || html === '<div>&#8203;</div>';\n      if (isEmpty) {\n        editorRef.current.classList.add('empty');\n        console.log('📭 编辑器状态: 空');\n      } else {\n        editorRef.current.classList.remove('empty');\n        console.log('📬 编辑器状态: 有内容');\n      }\n    }\n  };\n\n  // 从 DOM 更新内容状态 - 修复版本\n  const updateContentFromDOM = () => {\n    if (editorRef.current) {\n      const newContent = editorRef.current.innerHTML;\n\n      // 过滤掉零宽空格\n      const cleanContent = newContent.replace(/&#8203;|<\\/?div[^>]*>|<\\/?br[^>]*>/g, '').trim();\n      console.log('💾 准备保存内容，长度:', newContent.length, '清理后:', cleanContent.length);\n      if (cleanContent) {\n        setContent(newContent);\n        updateEmptyState();\n        const saveResult = storageService.saveDailyContent(date, newContent);\n        console.log('💽 保存结果:', saveResult ? '成功' : '失败', '键名:', `daily-content-${date}`);\n      } else {\n        // 如果内容为空，也保存空内容\n        setContent('');\n        updateEmptyState();\n        storageService.saveDailyContent(date, '');\n        console.log('💽 保存空内容');\n      }\n    }\n  };\n\n  // 内容变化处理 - 立即保存\n  const handleContentChange = () => {\n    if (isComposingRef.current) return;\n    console.log('⌨️ 内容变化触发');\n    // 立即保存，不使用防抖\n    updateContentFromDOM();\n  };\n  const handleCompositionStart = () => {\n    isComposingRef.current = true;\n    console.log('🇨🇳 中文输入开始');\n  };\n  const handleCompositionEnd = () => {\n    isComposingRef.current = false;\n    console.log('🇨🇳 中文输入结束');\n    updateContentFromDOM();\n  };\n  const handleKeyDown = e => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      document.execCommand('insertLineBreak');\n      // 立即保存\n      setTimeout(updateContentFromDOM, 10);\n    }\n  };\n  const saveContent = () => {\n    updateContentFromDOM();\n    alert('内容已保存！');\n  };\n  const handleEditorFocus = () => {\n    if (editorRef.current) {\n      editorRef.current.classList.remove('empty');\n      console.log('🎯 编辑器获得焦点');\n\n      // 如果只有零宽空格，清空它\n      if (editorRef.current.innerHTML === '&#8203;' || editorRef.current.innerHTML === '<div>&#8203;</div>') {\n        editorRef.current.innerHTML = '';\n        // 确保光标在正确位置\n        const range = document.createRange();\n        const selection = window.getSelection();\n        range.selectNodeContents(editorRef.current);\n        range.collapse(false);\n        selection.removeAllRanges();\n        selection.addRange(range);\n      }\n    }\n  };\n  const handleEditorBlur = () => {\n    console.log('👋 编辑器失去焦点');\n    updateEmptyState();\n    updateContentFromDOM(); // 失焦时也保存\n  };\n  const handleImageUpload = e => {\n    const file = e.target.files[0];\n    if (file) {\n      if (!file.type.startsWith('image/')) {\n        alert('请选择图片文件');\n        return;\n      }\n      if (file.size > 5 * 1024 * 1024) {\n        alert('图片大小不能超过 5MB');\n        return;\n      }\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        const imageUrl = reader.result;\n        console.log('🖼️ 图片上传完成，大小:', imageUrl.length);\n        if (editorRef.current) {\n          const selection = window.getSelection();\n          const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\n          const img = document.createElement('img');\n          img.src = imageUrl;\n          img.alt = \"uploaded\";\n          img.className = \"uploaded-image\";\n          if (range) {\n            range.insertNode(img);\n            const space = document.createTextNode(' ');\n            range.insertNode(space);\n            range.collapse(false);\n          } else {\n            editorRef.current.appendChild(img);\n            editorRef.current.appendChild(document.createTextNode(' '));\n          }\n          console.log('✅ 图片插入完成');\n          // 立即保存\n          updateContentFromDOM();\n        }\n      };\n      reader.onerror = () => {\n        alert('图片读取失败，请重试');\n      };\n      reader.readAsDataURL(file);\n    }\n    e.target.value = '';\n  };\n  const handleBackgroundUpload = e => {\n    const file = e.target.files[0];\n    if (file) {\n      if (!file.type.startsWith('image/')) {\n        alert('请选择图片文件');\n        return;\n      }\n      if (file.size > 5 * 1024 * 1024) {\n        alert('图片大小不能超过 5MB');\n        return;\n      }\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        const imageUrl = reader.result;\n        setBackgroundImage(imageUrl);\n        storageService.saveDailyBackground(date, imageUrl);\n        console.log('🎨 背景图片已保存');\n      };\n      reader.onerror = () => {\n        alert('背景图片读取失败，请重试');\n      };\n      reader.readAsDataURL(file);\n    }\n    e.target.value = '';\n  };\n  const addNewEvent = () => {\n    const title = prompt('请输入事件标题:');\n    if (!title || title.trim() === '') {\n      alert('事件标题不能为空');\n      return;\n    }\n    const type = prompt('请输入事件类型 (work/meeting/personal/urgent):', 'work');\n    const validTypes = ['work', 'meeting', 'personal', 'urgent'];\n    if (!validTypes.includes(type)) {\n      alert('事件类型必须是: work, meeting, personal 或 urgent');\n      return;\n    }\n    const startTime = prompt('请输入开始时间 (HH:mm)', '09:00');\n    const endTime = prompt('请输入结束时间 (HH:mm)', '10:00');\n    const timeRegex = /^([01]?[0-9]|2[0-3]):[0-5][0-9]$/;\n    if (!startTime || !endTime || !timeRegex.test(startTime) || !timeRegex.test(endTime)) {\n      alert('时间格式不正确，请使用 HH:mm 格式 (00:00 - 23:59)');\n      return;\n    }\n    const start = new Date(date + 'T' + startTime + ':00');\n    const end = new Date(date + 'T' + endTime + ':00');\n    if (end <= start) {\n      alert('结束时间必须晚于开始时间');\n      return;\n    }\n    const hasConflict = events.some(event => {\n      const eventStart = new Date(event.start);\n      const eventEnd = new Date(event.end);\n      return start < eventEnd && end > eventStart;\n    });\n    if (hasConflict) {\n      if (!confirm('该时间段与已有事件冲突，是否继续添加？')) {\n        return;\n      }\n    }\n    const newEvent = {\n      title: title.trim(),\n      start: start,\n      end: end,\n      type: type\n    };\n    const savedEvent = storageService.addEvent(newEvent);\n    setEvents(prev => [...prev, savedEvent]);\n    alert('事件添加成功！');\n  };\n  const deleteEvent = eventId => {\n    if (window.confirm('确定要删除这个事件吗？')) {\n      const updatedEvents = storageService.deleteEvent(eventId);\n      setEvents(updatedEvents.filter(event => moment(event.start).isSame(date, 'day')));\n      alert('事件已删除');\n    }\n  };\n  const formatEventType = type => {\n    const typeMap = {\n      'work': '💼 工作',\n      'meeting': '👥 会议',\n      'personal': '👤 个人',\n      'urgent': '🚨 紧急'\n    };\n    return typeMap[type] || type;\n  };\n  const getEventTypeColor = type => {\n    const colorMap = {\n      'work': '#3498db',\n      'meeting': '#9b59b6',\n      'personal': '#2ecc71',\n      'urgent': '#e74c3c'\n    };\n    return colorMap[type] || '#3498db';\n  };\n\n  // 调试函数 - 在控制台检查存储状态\n  const checkStorage = () => {\n    var _editorRef$current;\n    console.log('🔍 存储状态检查:');\n    console.log('当前日期:', date);\n    console.log('存储键:', `daily-content-${date}`);\n    console.log('存储内容:', localStorage.getItem(`daily-content-${date}`));\n    console.log('React状态内容:', content ? `有内容，长度: ${content.length}` : '空');\n    console.log('编辑器内容:', (_editorRef$current = editorRef.current) === null || _editorRef$current === void 0 ? void 0 : _editorRef$current.innerHTML.substring(0, 200));\n  };\n\n  // 在组件挂载时检查存储\n  useEffect(() => {\n    console.log('🚀 EventDetailPage 组件挂载');\n    checkStorage();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"event-detail-page\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"detail-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"back-btn\",\n        onClick: () => navigate('/'),\n        children: \"\\u2190 \\u8FD4\\u56DE\\u65E5\\u5386\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 355,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"detail-title\",\n        children: moment(date).format('YYYY年MM月DD日 dddd')\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 358,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          gap: '10px',\n          alignItems: 'center'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"toolbar-btn\",\n          onClick: checkStorage,\n          style: {\n            background: '#6c757d',\n            fontSize: '12px',\n            padding: '5px 10px'\n          },\n          children: \"\\uD83D\\uDD0D \\u8C03\\u8BD5\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 360,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"save-btn\",\n          onClick: saveContent,\n          children: \"\\uD83D\\uDCBE \\u4FDD\\u5B58\\u5185\\u5BB9\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 367,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 359,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 354,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"detail-content\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"editor-toolbar\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"toolbar-btn\",\n          onClick: () => setShowImageUpload(!showImageUpload),\n          children: \"\\uD83D\\uDCF7 \\u6DFB\\u52A0\\u56FE\\u7247\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 375,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"toolbar-btn\",\n          children: [\"\\uD83D\\uDDBC\\uFE0F \\u80CC\\u666F\\u56FE\\u7247\", /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            accept: \"image/*\",\n            onChange: handleBackgroundUpload,\n            style: {\n              display: 'none'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 384,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 382,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"toolbar-btn\",\n          onClick: addNewEvent,\n          children: \"\\u2795 \\u6DFB\\u52A0\\u4E8B\\u4EF6\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 392,\n          columnNumber: 11\n        }, this), showImageUpload && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"image-upload-panel\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"\\u9009\\u62E9\\u56FE\\u7247\\uFF1A\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 398,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            accept: \"image/*\",\n            onChange: handleImageUpload\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 399,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 397,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 374,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"events-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: [\"\\uD83D\\uDCC5 \\u4ECA\\u65E5\\u4E8B\\u4EF6 (\", events.length, \")\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 409,\n          columnNumber: 11\n        }, this), events.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"events-list\",\n          children: events.map(event => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"event-card\",\n            style: {\n              borderLeftColor: getEventTypeColor(event.type)\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n                children: event.title\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 419,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                children: [moment(event.start).format('HH:mm'), \" - \", moment(event.end).format('HH:mm')]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 420,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 418,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"event-actions\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"event-type\",\n                style: {\n                  backgroundColor: getEventTypeColor(event.type)\n                },\n                children: formatEventType(event.type)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 425,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"delete-event-btn\",\n                onClick: () => deleteEvent(event.id),\n                children: \"\\u5220\\u9664\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 431,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 424,\n              columnNumber: 19\n            }, this)]\n          }, event.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 413,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 411,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"no-events\",\n          children: \"\\u6682\\u65E0\\u4E8B\\u4EF6\\uFF0C\\u70B9\\u51FB\\\"\\u6DFB\\u52A0\\u4E8B\\u4EF6\\\"\\u6309\\u94AE\\u521B\\u5EFA\\u65B0\\u4E8B\\u4EF6\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 442,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 408,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: editorRef,\n        className: \"content-editor\",\n        contentEditable: true,\n        suppressContentEditableWarning: true,\n        onInput: handleContentChange,\n        onFocus: handleEditorFocus,\n        onBlur: handleEditorBlur,\n        onKeyDown: handleKeyDown,\n        onCompositionStart: handleCompositionStart,\n        onCompositionEnd: handleCompositionEnd,\n        style: {\n          backgroundImage: backgroundImage ? `url(${backgroundImage})` : 'none',\n          backgroundSize: 'cover',\n          backgroundPosition: 'center',\n          backgroundColor: backgroundImage ? 'rgba(255, 255, 255, 0.9)' : 'transparent'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 446,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 373,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 353,\n    columnNumber: 5\n  }, this);\n};\n_s(EventDetailPage, \"FoEaXdrJ7uHf15jk0uy1nT52OnE=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = EventDetailPage;\nexport default EventDetailPage;\nvar _c;\n$RefreshReg$(_c, \"EventDetailPage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useParams","useNavigate","moment","storageService","jsxDEV","_jsxDEV","EventDetailPage","_s","date","navigate","content","setContent","backgroundImage","setBackgroundImage","events","setEvents","showImageUpload","setShowImageUpload","editorRef","isComposingRef","isInitializedRef","console","log","savedContent","getDailyContent","savedBackground","getDailyBackground","dateEvents","getEventsByDate","length","current","selection","window","getSelection","range","rangeCount","getRangeAt","currentFocus","document","activeElement","innerHTML","substring","removeAllRanges","addRange","updateEmptyState","html","isEmpty","classList","add","remove","updateContentFromDOM","newContent","cleanContent","replace","trim","saveResult","saveDailyContent","handleContentChange","handleCompositionStart","handleCompositionEnd","handleKeyDown","e","key","preventDefault","execCommand","setTimeout","saveContent","alert","handleEditorFocus","createRange","selectNodeContents","collapse","handleEditorBlur","handleImageUpload","file","target","files","type","startsWith","size","reader","FileReader","onloadend","imageUrl","result","img","createElement","src","alt","className","insertNode","space","createTextNode","appendChild","onerror","readAsDataURL","value","handleBackgroundUpload","saveDailyBackground","addNewEvent","title","prompt","validTypes","includes","startTime","endTime","timeRegex","test","start","Date","end","hasConflict","some","event","eventStart","eventEnd","confirm","newEvent","savedEvent","addEvent","prev","deleteEvent","eventId","updatedEvents","filter","isSame","formatEventType","typeMap","getEventTypeColor","colorMap","checkStorage","_editorRef$current","localStorage","getItem","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","format","style","display","gap","alignItems","background","fontSize","padding","accept","onChange","map","borderLeftColor","backgroundColor","id","ref","contentEditable","suppressContentEditableWarning","onInput","onFocus","onBlur","onKeyDown","onCompositionStart","onCompositionEnd","backgroundSize","backgroundPosition","_c","$RefreshReg$"],"sources":["/Users/zxydediannao/new_fashion-calendar/fashion-calendar/src/components/EventDetailPage.jsx"],"sourcesContent":["// src/components/EventDetailPage.jsx\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport moment from 'moment';\nimport './EventDetailPage.css';\nimport { storageService } from '../utils/storage';\n\nconst EventDetailPage = () => {\n  const { date } = useParams();\n  const navigate = useNavigate();\n  const [content, setContent] = useState('');\n  const [backgroundImage, setBackgroundImage] = useState('');\n  const [events, setEvents] = useState([]);\n  const [showImageUpload, setShowImageUpload] = useState(false);\n  const editorRef = useRef(null);\n  const isComposingRef = useRef(false);\n  const isInitializedRef = useRef(false); // 防止重复初始化\n\n  // 加载该日期的事件数据 - 修复版本\n  useEffect(() => {\n    console.log('🔍 加载数据，日期:', date);\n    \n    const savedContent = storageService.getDailyContent(date);\n    const savedBackground = storageService.getDailyBackground(date);\n    const dateEvents = storageService.getEventsByDate(date);\n\n    console.log('📝 加载到的内容:', savedContent ? `有内容，长度: ${savedContent.length}` : '无内容');\n    console.log('🖼️ 背景图片:', savedBackground ? '有' : '无');\n    console.log('📅 事件数量:', dateEvents.length);\n    \n    // 立即设置内容状态\n    setContent(savedContent || '');\n    setBackgroundImage(savedBackground || '');\n    setEvents(dateEvents);\n    \n    isInitializedRef.current = true;\n  }, [date]);\n\n  // 初始化编辑器内容 - 关键修复！\n  useEffect(() => {\n    if (!editorRef.current) return;\n    \n    console.log('🎯 初始化编辑器，当前内容状态:', content ? `有内容，长度: ${content.length}` : '空');\n    \n    // 保存当前选区\n    const selection = window.getSelection();\n    const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\n    const currentFocus = document.activeElement;\n    \n    // 设置编辑器内容\n    editorRef.current.innerHTML = content || '';\n    \n    console.log('✅ 编辑器内容已设置:', editorRef.current.innerHTML.substring(0, 100));\n    \n    // 恢复选区\n    if (range && currentFocus === editorRef.current) {\n      selection.removeAllRanges();\n      selection.addRange(range);\n    }\n    \n    // 更新空状态\n    updateEmptyState();\n    \n  }, [content, date]); // 依赖 content 和 date\n\n  const updateEmptyState = () => {\n    if (editorRef.current) {\n      const html = editorRef.current.innerHTML;\n      const isEmpty = !html || \n                     html === '<br>' || \n                     html === '<div><br></div>' || \n                     html === '&#8203;' ||\n                     html === '<div>&#8203;</div>';\n      \n      if (isEmpty) {\n        editorRef.current.classList.add('empty');\n        console.log('📭 编辑器状态: 空');\n      } else {\n        editorRef.current.classList.remove('empty');\n        console.log('📬 编辑器状态: 有内容');\n      }\n    }\n  };\n\n  // 从 DOM 更新内容状态 - 修复版本\n  const updateContentFromDOM = () => {\n    if (editorRef.current) {\n      const newContent = editorRef.current.innerHTML;\n      \n      // 过滤掉零宽空格\n      const cleanContent = newContent.replace(/&#8203;|<\\/?div[^>]*>|<\\/?br[^>]*>/g, '').trim();\n      \n      console.log('💾 准备保存内容，长度:', newContent.length, '清理后:', cleanContent.length);\n      \n      if (cleanContent) {\n        setContent(newContent);\n        updateEmptyState();\n        const saveResult = storageService.saveDailyContent(date, newContent);\n        console.log('💽 保存结果:', saveResult ? '成功' : '失败', '键名:', `daily-content-${date}`);\n      } else {\n        // 如果内容为空，也保存空内容\n        setContent('');\n        updateEmptyState();\n        storageService.saveDailyContent(date, '');\n        console.log('💽 保存空内容');\n      }\n    }\n  };\n\n  // 内容变化处理 - 立即保存\n  const handleContentChange = () => {\n    if (isComposingRef.current) return;\n    \n    console.log('⌨️ 内容变化触发');\n    // 立即保存，不使用防抖\n    updateContentFromDOM();\n  };\n\n  const handleCompositionStart = () => {\n    isComposingRef.current = true;\n    console.log('🇨🇳 中文输入开始');\n  };\n\n  const handleCompositionEnd = () => {\n    isComposingRef.current = false;\n    console.log('🇨🇳 中文输入结束');\n    updateContentFromDOM();\n  };\n\n  const handleKeyDown = (e) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      document.execCommand('insertLineBreak');\n      // 立即保存\n      setTimeout(updateContentFromDOM, 10);\n    }\n  };\n\n  const saveContent = () => {\n    updateContentFromDOM();\n    alert('内容已保存！');\n  };\n\n  const handleEditorFocus = () => {\n    if (editorRef.current) {\n      editorRef.current.classList.remove('empty');\n      console.log('🎯 编辑器获得焦点');\n      \n      // 如果只有零宽空格，清空它\n      if (editorRef.current.innerHTML === '&#8203;' || editorRef.current.innerHTML === '<div>&#8203;</div>') {\n        editorRef.current.innerHTML = '';\n        // 确保光标在正确位置\n        const range = document.createRange();\n        const selection = window.getSelection();\n        range.selectNodeContents(editorRef.current);\n        range.collapse(false);\n        selection.removeAllRanges();\n        selection.addRange(range);\n      }\n    }\n  };\n\n  const handleEditorBlur = () => {\n    console.log('👋 编辑器失去焦点');\n    updateEmptyState();\n    updateContentFromDOM(); // 失焦时也保存\n  };\n\n  const handleImageUpload = (e) => {\n    const file = e.target.files[0];\n    if (file) {\n      if (!file.type.startsWith('image/')) {\n        alert('请选择图片文件');\n        return;\n      }\n\n      if (file.size > 5 * 1024 * 1024) {\n        alert('图片大小不能超过 5MB');\n        return;\n      }\n\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        const imageUrl = reader.result;\n        console.log('🖼️ 图片上传完成，大小:', imageUrl.length);\n        \n        if (editorRef.current) {\n          const selection = window.getSelection();\n          const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\n          \n          const img = document.createElement('img');\n          img.src = imageUrl;\n          img.alt = \"uploaded\";\n          img.className = \"uploaded-image\";\n          \n          if (range) {\n            range.insertNode(img);\n            const space = document.createTextNode(' ');\n            range.insertNode(space);\n            range.collapse(false);\n          } else {\n            editorRef.current.appendChild(img);\n            editorRef.current.appendChild(document.createTextNode(' '));\n          }\n          \n          console.log('✅ 图片插入完成');\n          // 立即保存\n          updateContentFromDOM();\n        }\n      };\n      \n      reader.onerror = () => {\n        alert('图片读取失败，请重试');\n      };\n      \n      reader.readAsDataURL(file);\n    }\n    e.target.value = '';\n  };\n\n  const handleBackgroundUpload = (e) => {\n    const file = e.target.files[0];\n    if (file) {\n      if (!file.type.startsWith('image/')) {\n        alert('请选择图片文件');\n        return;\n      }\n\n      if (file.size > 5 * 1024 * 1024) {\n        alert('图片大小不能超过 5MB');\n        return;\n      }\n\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        const imageUrl = reader.result;\n        setBackgroundImage(imageUrl);\n        storageService.saveDailyBackground(date, imageUrl);\n        console.log('🎨 背景图片已保存');\n      };\n      \n      reader.onerror = () => {\n        alert('背景图片读取失败，请重试');\n      };\n      \n      reader.readAsDataURL(file);\n    }\n    e.target.value = '';\n  };\n\n  const addNewEvent = () => {\n    const title = prompt('请输入事件标题:');\n    if (!title || title.trim() === '') {\n      alert('事件标题不能为空');\n      return;\n    }\n\n    const type = prompt('请输入事件类型 (work/meeting/personal/urgent):', 'work');\n    const validTypes = ['work', 'meeting', 'personal', 'urgent'];\n    if (!validTypes.includes(type)) {\n      alert('事件类型必须是: work, meeting, personal 或 urgent');\n      return;\n    }\n\n    const startTime = prompt('请输入开始时间 (HH:mm)', '09:00');\n    const endTime = prompt('请输入结束时间 (HH:mm)', '10:00');\n\n    const timeRegex = /^([01]?[0-9]|2[0-3]):[0-5][0-9]$/;\n    if (!startTime || !endTime || !timeRegex.test(startTime) || !timeRegex.test(endTime)) {\n      alert('时间格式不正确，请使用 HH:mm 格式 (00:00 - 23:59)');\n      return;\n    }\n\n    const start = new Date(date + 'T' + startTime + ':00');\n    const end = new Date(date + 'T' + endTime + ':00');\n    \n    if (end <= start) {\n      alert('结束时间必须晚于开始时间');\n      return;\n    }\n\n    const hasConflict = events.some(event => {\n      const eventStart = new Date(event.start);\n      const eventEnd = new Date(event.end);\n      return (start < eventEnd && end > eventStart);\n    });\n\n    if (hasConflict) {\n      if (!confirm('该时间段与已有事件冲突，是否继续添加？')) {\n        return;\n      }\n    }\n\n    const newEvent = {\n      title: title.trim(),\n      start: start,\n      end: end,\n      type: type\n    };\n\n    const savedEvent = storageService.addEvent(newEvent);\n    setEvents(prev => [...prev, savedEvent]);\n    alert('事件添加成功！');\n  };\n\n  const deleteEvent = (eventId) => {\n    if (window.confirm('确定要删除这个事件吗？')) {\n      const updatedEvents = storageService.deleteEvent(eventId);\n      setEvents(updatedEvents.filter(event => \n        moment(event.start).isSame(date, 'day')\n      ));\n      alert('事件已删除');\n    }\n  };\n\n  const formatEventType = (type) => {\n    const typeMap = {\n      'work': '💼 工作',\n      'meeting': '👥 会议',\n      'personal': '👤 个人',\n      'urgent': '🚨 紧急'\n    };\n    return typeMap[type] || type;\n  };\n\n  const getEventTypeColor = (type) => {\n    const colorMap = {\n      'work': '#3498db',\n      'meeting': '#9b59b6',\n      'personal': '#2ecc71',\n      'urgent': '#e74c3c'\n    };\n    return colorMap[type] || '#3498db';\n  };\n\n  // 调试函数 - 在控制台检查存储状态\n  const checkStorage = () => {\n    console.log('🔍 存储状态检查:');\n    console.log('当前日期:', date);\n    console.log('存储键:', `daily-content-${date}`);\n    console.log('存储内容:', localStorage.getItem(`daily-content-${date}`));\n    console.log('React状态内容:', content ? `有内容，长度: ${content.length}` : '空');\n    console.log('编辑器内容:', editorRef.current?.innerHTML.substring(0, 200));\n  };\n\n  // 在组件挂载时检查存储\n  useEffect(() => {\n    console.log('🚀 EventDetailPage 组件挂载');\n    checkStorage();\n  }, []);\n\n  return (\n    <div className=\"event-detail-page\">\n      <div className=\"detail-header\">\n        <button className=\"back-btn\" onClick={() => navigate('/')}>\n          ← 返回日历\n        </button>\n        <h1 className=\"detail-title\">{moment(date).format('YYYY年MM月DD日 dddd')}</h1>\n        <div style={{ display: 'flex', gap: '10px', alignItems: 'center' }}>\n          <button \n            className=\"toolbar-btn\" \n            onClick={checkStorage}\n            style={{ background: '#6c757d', fontSize: '12px', padding: '5px 10px' }}\n          >\n            🔍 调试\n          </button>\n          <button className=\"save-btn\" onClick={saveContent}>\n            💾 保存内容\n          </button>\n        </div>\n      </div>\n      \n      <div className=\"detail-content\">\n        <div className=\"editor-toolbar\">\n          <button \n            className=\"toolbar-btn\" \n            onClick={() => setShowImageUpload(!showImageUpload)}\n          >\n            📷 添加图片\n          </button>\n          \n          <label className=\"toolbar-btn\">\n            🖼️ 背景图片\n            <input \n              type=\"file\" \n              accept=\"image/*\" \n              onChange={handleBackgroundUpload}\n              style={{ display: 'none' }}\n            />\n          </label>\n          \n          <button className=\"toolbar-btn\" onClick={addNewEvent}>\n            ➕ 添加事件\n          </button>\n          \n          {showImageUpload && (\n            <div className=\"image-upload-panel\">\n              <span>选择图片：</span>\n              <input \n                type=\"file\" \n                accept=\"image/*\" \n                onChange={handleImageUpload}\n              />\n            </div>\n          )}\n        </div>\n        \n        <div className=\"events-section\">\n          <h3>📅 今日事件 ({events.length})</h3>\n          {events.length > 0 ? (\n            <div className=\"events-list\">\n              {events.map(event => (\n                <div \n                  key={event.id} \n                  className=\"event-card\"\n                  style={{ borderLeftColor: getEventTypeColor(event.type) }}\n                >\n                  <div>\n                    <h4>{event.title}</h4>\n                    <p>\n                      {moment(event.start).format('HH:mm')} - {moment(event.end).format('HH:mm')}\n                    </p>\n                  </div>\n                  <div className=\"event-actions\">\n                    <span \n                      className=\"event-type\"\n                      style={{ backgroundColor: getEventTypeColor(event.type) }}\n                    >\n                      {formatEventType(event.type)}\n                    </span>\n                    <button \n                      className=\"delete-event-btn\"\n                      onClick={() => deleteEvent(event.id)}\n                    >\n                      删除\n                    </button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <p className=\"no-events\">暂无事件，点击\"添加事件\"按钮创建新事件</p>\n          )}\n        </div>\n        \n        <div \n          ref={editorRef}\n          className=\"content-editor\"\n          contentEditable\n          suppressContentEditableWarning\n          onInput={handleContentChange}\n          onFocus={handleEditorFocus}\n          onBlur={handleEditorBlur}\n          onKeyDown={handleKeyDown}\n          onCompositionStart={handleCompositionStart}\n          onCompositionEnd={handleCompositionEnd}\n          style={{ \n            backgroundImage: backgroundImage ? `url(${backgroundImage})` : 'none',\n            backgroundSize: 'cover',\n            backgroundPosition: 'center',\n            backgroundColor: backgroundImage ? 'rgba(255, 255, 255, 0.9)' : 'transparent'\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default EventDetailPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}